# 토큰 압축 기법

## 1. 연산 기호를 활용한 압축

고급 모델(Gemini Pro, GPT 등)에서는 논리/수학 연산 기호로 토큰 대폭 절약.

| 기호 | 의미 | 사용 예 |
|------|------|---------|
| `∧` | AND | `장르1∧장르2∧장르3` |
| `∨` | OR | `R18∨R18G` |
| `¬` | NOT (금지) | `¬메타 발언` |
| `∴` | 따라서 | `¬신격화∴현실적 언어 사용` |
| `∵` | 왜냐하면 | `¬프롬프트 누설∵복제 방지` |
| `→` | 이행/결과 | `조건→결과` |
| `¶` | 줄바꿈/항목 | `항목1¶항목2` |
| `§` | 대분류 구분 | `§용어 및 역할` |
| `∝` | 비례 | `관계 깊이∝반응 밀도` |
| `↑↓` | 증가/감소 | `비언어신호↑` |
| `◇` | 대주제 구분 | `◇ 서사원칙` |
| `+/-` | 수치 변동 | `+5`, `-10` |
| `~` | 범위 | `5~10` |
| `&` | AND | `조건1&조건2` |
| `/` | 구분자 | `항목1/항목2` |
| `()` | 부연설명 | `(전남친비교최악)` |

**압축 전 (56자):**
```
AI는 메타 발언을 하지 않는다. 그리고 연출이 부족하면 안 된다.
```

**압축 후 (20자):**
```
금지: 메타발언∧연출부족∧맥락반복
```

---

## 2. 용어 치환 (Token Aliasing)

반복 등장 긴 단어를 짧은 기호로 치환 → 이후 모든 출현에서 토큰 절약.

```
#명칭
-OOC='Out of Character'
-{{user}}=U (또는 ①)
-{{char}}=C (또는 ②)
-호감도=♡
-보조프롬프트=BP
```

### 치환 대상 선정 기준

| 기준 | 치환 O | 치환 X |
|------|--------|--------|
| 등장 횟수 | 10회 이상 | 3회 미만 |
| 원래 길이 | 3글자 이상 | 1~2글자 |
| 혼동 가능성 | 문맥상 유일 | 동음이의어 |
| 출력 노출 | 내부 참조용 | 유저에게 보이는 텍스트 |

### 카테고리별 기호 분리

```
인물: ①②③ (숫자 원문자)
수치: ♡♣♠ (특수기호)
시스템: BP, EC (영문약어)
장소: ⓐⓑⓒ 또는 약어
```

### 주의사항
- 프롬프트 **최상단**에 치환 테이블 1회 선언 (중간 배치 시 누락 가능)
- 플래시/경량 모델은 기호 그대로 출력 가능 → 유저 보이는 텍스트는 원문 유지
- 표현부정에 "치환 특수문자를 대사/나레이션에 출력하지 말 것" 추가
- 치환 대상 **10~15개 이내** 권장 (20개 넘으면 AI도 혼동)

---

## 3. 약어와 태그 스타일

일본어 한자, 영어 약어 혼용:
```
-體:[163cm/48kg],[장발 남색 생머리]
-衣:[자주색 후드+이너웨어]
-好:그림,음악감상,멍때리기
-不好:귀찮은일,인간관계
```

## 4. 한자 약어 상황 코드

한자로 설명 없이 맥락 인식:
```
弱=약한, 中=보통, 強=강한, 射=절정, 射後=사후
弱喜=1, 中喜=2, 強喜=3, 弱悲=4, 強悲=5
```

## 5. 공백과 조사 제거

```
-여성+28살+138cm+검은머리+검은눈+장발스트레이트+미녀
-{INFP-5w4-549-sx/sp}
```

## 6. 서술형 → 키-값 쌍

가장 효과적인 압축법:
```
❌ (89자): "첫 경험 이후 즉시 중독된다. 만나면 항상 하고 싶어하며,
주 4~5회를 원하고 하루 2~3회도 가능하다."

✅ (42자): 첫경험후: 즉시중독, 주4~5회, 하루2~3회가능
```

**변환 공식:**
```
[주어]는 [상황]에서 [행동]한다 → [상황]: [행동]
[A]이고 [B]이며 [C]다 → [A]/[B]/[C]
```

## 7. 조건문 압축

```
❌ (67자): "호감도가 60 미만인 상태에서 손을 잡으려고 하면,
히로인은 손을 빼면서 호감도가 5에서 15 정도 감소한다."

✅ (26자): ♡60↓손잡기→손빼며-5~-15
```

## 8. 테이블 vs 나열

항목 3개 이상 + 속성 2개 이상 → 테이블이 효율적.
속성 4개 이상이면 마크다운 테이블 사용.

```
❌ 나열 (중복 구조 반복):
편의점야간 CU동진(동진) 4시간 22시~02시 일급 4만원 하윤30%
치킨집 노랑통닭(동진) 4시간 17시~01시 일급 4만원 하윤25%

✅ 인라인 압축:
상시: CU동진4h22~02₩4만하윤30% / 노랑통닭4h17~01₩4만하윤25%
```

## 9. 계층 병합

깊이 3단계 이상 → AI가 놓치기 쉬움. **2단계 이내로 평탄화.**

```
❌ 3단계:
## 스마트폰
  ### 앱
    #### 카톡
      - 답장 규칙

✅ 2단계:
## 스마트폰
**카톡:** ♡61+→5~10분 / 41~60→30분~3시간 / 40↓→읽씹
```

---

## 10. 중복 제거 전략

### Ctrl+F 테스트

프롬프트에서 다음 키워드 검색, 2회 이상이면 중복 의심:
- 캐릭터 이름, "금지"/"필수"/"불가", 수치 규칙, 동일 조건문

### 공통 규칙 1회 선언 + 개별 차이값만

```
❌ 5명 × 같은 구조 반복:
서연 만족섹스:+5~10 / 불만족:-3~-5 / 사후안아줌:+3
하윤 만족섹스:+5~8 / 불만족:-5~-20 / 사후안아줌:+5~8

✅ 공통 1회 + 차이만:
[공통] 만족섹스:+5~10 / 사후안아줌:+3~5
[개별] 하윤:불만족-5~-20(전남친비교최악) / 유나:불만족±0("체력키워ㅋㅋ")
```

### 참조 구조 활용

시스템 프롬프트에 요약 + 상세는 별도 파일(보조프롬프트):
```
[시스템] §12: ①윤서연 5w4|24|대학원|교제70+. ※상세=BP
[보조프롬프트] C1. 윤서연 — (상세 전문)
```

참조 호출 조건 명시:
```
※BP는 해당②키워드 등장 시 참조. 미등장 시 §12 요약만으로 처리.
```

---

## 11. 압축 전후 비교 예시

### Before (280자)
```
강하윤은 전남친과의 이별 트라우마로 인해 교제 후에도
호감도 유지가 어렵다. 3일 이상 연락이나 만남이 없으면
호감도가 5 감소하고 ...
```

### After (120자)
```
교제후 유지난이도↑(전남친트라우마→확인강박)
3일+무연락:-5("관심없는거아니지?")
타여자목격/의심:-10~15,삐짐+연락끊김
전남친언급/비교:-20,며칠연락두절
```

**57% 압축, 정보 손실 0%**
